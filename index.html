<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>siymon</title>

  <!-- âœ… PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#ff5722">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="siymon">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    :root{
      --bg:#F7F4EF;
      --card:#ffffff;
      --text:#111;
      --muted:#666;
      --brand:#ff5722;
      --brand2:#1f8a70;
      --shadow:0 6px 18px rgba(0,0,0,.10);
      --radius:16px;
    }

    /* âœ… Dark Theme */
    html[data-theme="dark"]{
      --bg:#0f0f10;
      --card:#17181a;
      --text:#f2f2f2;
      --muted:#b8b8b8;
      --shadow:0 10px 25px rgba(0,0,0,.45);
    }
    html[data-theme="dark"] header{
      background:rgba(15,15,16,.92);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    html[data-theme="dark"] .btn.ghost{ border:1px solid rgba(255,255,255,.12); }
    html[data-theme="dark"] .chip{ border:1px solid rgba(255,255,255,.12); }
    html[data-theme="dark"] .badge,
    html[data-theme="dark"] .chip,
    html[data-theme="dark"] .btn{
      background:var(--card);
      color:var(--text);
    }
    html[data-theme="dark"] .field input,
    html[data-theme="dark"] .field textarea{
      background:var(--card);
      color:var(--text);
      border:1px solid rgba(255,255,255,.14);
    }
    html[data-theme="dark"] .cart-item{
      background:var(--card);
      border:1px solid rgba(255,255,255,.10);
    }
    html[data-theme="dark"] .qty button{
      background:var(--card);
      color:var(--text);
      border:1px solid rgba(255,255,255,.14);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.5;
    }

    header{
      position:sticky; top:0; z-index:50;
      background:rgba(247,244,239,.92);
      backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(0,0,0,.06);
    }

    .wrap{width:min(1150px, 92%); margin:auto}

    /* âœ… Topbar = Brand | Social | Actions */
    .topbar{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      padding:14px 0;
      gap:12px;
    }

    .brand{display:flex; align-items:center; gap:12px; justify-self:start;}
    .logo-img{
      width:50px;
      height:50px;
      border-radius:14px;
      object-fit:contain;
      box-shadow: var(--shadow);
      background:#000;
      padding:6px;
    }
    .brand h1{margin:0; font-size:20px; letter-spacing:.4px;}
    .brand p{margin:0; color:var(--muted); font-size:13px}

    .actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-self:end;}

    .btn{
      border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      background:#fff;
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
      color:#111;
      font-weight:700;
      transition:.15s transform ease, .15s opacity ease;
      display:inline-flex; align-items:center; gap:8px;
      white-space:nowrap;
      justify-content:center;
      text-decoration:none;
    }
    .btn:active{transform:scale(.98)}
    .btn.primary{background:var(--brand); color:#fff}
    .btn.good{background:var(--brand2); color:#fff}
    .btn.ghost{background:transparent; box-shadow:none; border:1px solid rgba(0,0,0,.10)}
    .btn:disabled{opacity:.65; cursor:not-allowed}

    /* âœ… Ø²Ø± Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙ‚Ø· */
    .icon-btn{
      width:44px;
      padding:10px 0;
      display:inline-flex;
      justify-content:center;
      align-items:center;
      font-size:18px;
      line-height:1;
    }

    /* âœ… Social buttons */
    .social-links{
      justify-self:center;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .social-btn{
      width:36px;
      height:36px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:12px;
      text-decoration:none;
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
      border:1px solid rgba(0,0,0,.10);
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
    }
    .social-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
      opacity:.96;
    }
    .social-btn svg{ width:18px; height:18px; fill:#fff; }

    .social-btn.fb{ background:#1877F2; }
    .social-btn.ig{
      background: radial-gradient(circle at 30% 110%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
    }

    html[data-theme="dark"] .social-btn{
      border:1px solid rgba(255,255,255,.14);
      box-shadow:none;
    }

    /* âœ… Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© */
    .statusbar{
      display:flex;
      gap:10px;
      align-items:center;
      padding:0 0 14px 0;
      flex-wrap:wrap;
    }
    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
      font-weight:800;
      font-size:13px;
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:50%;
      background:#bbb;
      display:inline-block;
    }
    .badge.open .dot{ background: var(--brand2); }
    .badge.closed .dot{ background: #d33; }
    .status-text{color:var(--muted); font-size:12px}

    .chips{
      display:flex; gap:10px; flex-wrap:wrap;
      padding:0 0 10px 0;
    }
    .chip{
      padding:9px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      cursor:pointer;
      font-weight:800;
      color:#222;
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
      user-select:none;
    }
    .chip.active{
      border-color: rgba(255,87,34,.35);
      box-shadow: 0 8px 18px rgba(255,87,34,.12);
      color: var(--brand);
    }

    main{padding:18px 0 40px}

    .layout{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1.6fr .9fr;
      gap:18px;
      align-items:start;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:14px;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:12px;
      display:flex;
      flex-direction:column;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.05);
    }
    .img{
      width:100%;
      height:150px;
      border-radius:14px;
      background:#eee;
      overflow:hidden;
    }
    .img img{width:100%; height:100%; object-fit:cover; display:block}
    .card h3{margin:10px 0 2px 0; font-size:16px}
    .card p{margin:0; color:var(--muted); font-size:13px; min-height:38px}
    .row{display:flex; justify-content:space-between; align-items:center; margin-top:10px; gap:10px;}
    .price{font-weight:900}
    .add{width:100%}

    .side{position:sticky; top:90px;}

    .panel{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      border:1px solid rgba(0,0,0,.05);
    }
    .panel h3{margin:0 0 10px 0}
    .cart-items{display:flex; flex-direction:column; gap:10px; margin:10px 0}
    .cart-item{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
      padding:10px;
      background:#fff;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.06);
    }
    .cart-item b{display:block}
    .cart-item small{color:var(--muted)}
    .qty{display:flex; align-items:center; gap:8px; justify-content:flex-end;}
    .qty button{
      width:34px; height:34px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      cursor:pointer;
      font-weight:900;
    }
    .qty span{min-width:18px; text-align:center; font-weight:900}

    .totals-row{
      display:flex; justify-content:space-between; align-items:center;
      margin-top:8px;
      font-weight:900;
    }
    .totals{
      border-top:1px dashed rgba(0,0,0,.18);
      padding-top:10px;
      display:flex; justify-content:space-between; align-items:center;
      margin-top:10px;
      font-weight:900;
    }

    .form{margin-top:12px; display:grid; gap:10px;}
    .field label{display:block; font-weight:900; font-size:13px; margin-bottom:6px}
    .field input, .field textarea{
      width:100%;
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      background:#fff;
      font-size:14px;
    }
    .field textarea{min-height:70px; resize:vertical}

    .hint{font-size:12px; color:var(--muted); margin-top:6px}
    .muted{color:var(--muted)}
    .empty{
      padding:12px;
      border-radius:14px;
      border:1px dashed rgba(0,0,0,.2);
      color:var(--muted);
      text-align:center;
      background:rgba(255,255,255,.6);
    }

    footer{
      padding:18px 0 30px;
      color:var(--muted);
      font-size:12px;
      text-align:center;
    }

    @media (max-width: 980px){
      .layout{grid-template-columns:1fr}
      .side{position:static}
    }

    @media (max-width: 760px){
      .topbar{
        grid-template-columns: 1fr 1fr;
        grid-template-areas:
          "brand actions"
          "social social";
        row-gap:10px;
      }
      .brand{grid-area:brand; justify-self:start;}
      .actions{grid-area:actions; justify-self:end;}
      .social-links{grid-area:social; justify-self:center;}
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <img class="logo-img"
               src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Photoroom-20260117_132534545.png"
               alt="siymon logo" />
          <div>
            <h1>siymon</h1>
            <p id="subtitle">Ø§Ø·Ù„Ø¨ Ø£ÙƒÙ„Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ø¨Ø³Ø±Ø¹Ø©</p>
          </div>
        </div>

        <div class="social-links" aria-label="Social">
          <a class="social-btn ig"
             href="https://www.instagram.com/siymon7?igsh=Ync3dXN6MWQ2a2Vr"
             target="_blank" rel="noopener"
             aria-label="Instagram" title="Instagram">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2zm0 2A3.5 3.5 0 0 0 4 7.5v9A3.5 3.5 0 0 0 7.5 20h9a3.5 3.5 0 0 0 3.5-3.5v-9A3.5 3.5 0 0 0 16.5 4h-9z"/>
              <path d="M12 7.2A4.8 4.8 0 1 1 7.2 12 4.8 4.8 0 0 1 12 7.2zm0 2A2.8 2.8 0 1 0 14.8 12 2.8 2.8 0 0 0 12 9.2z"/>
              <path d="M17.6 6.3a1.1 1.1 0 1 1-1.1 1.1 1.1 1.1 0 0 1 1.1-1.1z"/>
            </svg>
          </a>

          <a class="social-btn fb"
             href="https://www.facebook.com/share/1AV3nJV3dZ/"
             target="_blank" rel="noopener"
             aria-label="Facebook" title="Facebook">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M13.6 22v-8.2h2.8l.4-3H13.6V9.1c0-.9.3-1.6 1.7-1.6h1.5V5c-.3 0-1.4-.1-2.7-.1-2.7 0-4.6 1.6-4.6 4.6v1.9H7v3h2.5V22h4.1z"/>
            </svg>
          </a>
        </div>

        <div class="actions">
          <button class="btn ghost" id="langToggle" type="button">EN</button>
          <button class="btn ghost icon-btn" id="installBtn" type="button" title="Install" aria-label="Install" style="display:none">â¬‡ï¸</button>
          <button class="btn ghost icon-btn" id="themeToggle" type="button" title="Theme" aria-label="Theme">ğŸŒ™</button>

          <!-- âœ… Ø²Ø± ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø±Ù -->
          <button class="btn ghost icon-btn" id="adminBtn" type="button" title="Admin" aria-label="Admin">Admin</button>

          <a class="btn ghost icon-btn" id="supportCall" href="#" title="Support" aria-label="Support">ğŸ“</a>
          <button class="btn" id="clearCart" type="button">ğŸ§¹ <span id="clearText">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</span></button>
          <button class="btn primary" id="goCart" type="button">ğŸ›’ <span id="cartCount">0</span></button>
        </div>
      </div>

      <div class="statusbar">
        <span id="openBadge" class="badge">
          <span class="dot"></span>
          <span id="openText">...</span>
        </span>
        <span id="hoursText" class="status-text"></span>
      </div>

      <div class="chips" id="categoryChips"></div>
    </div>
  </header>

  <main class="wrap">
    <section class="layout">
      <div>
        <div class="grid" id="productsGrid"></div>
      </div>

      <aside class="side">
        <div class="panel" id="cartPanel">
          <h3 id="cartTitle">Ø§Ù„Ø³Ù„Ø©</h3>
          <div id="cartItems" class="cart-items"></div>

          <div class="totals-row">
            <span id="subTotalLabel">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
            <span id="subTotalValue">0.00</span>
          </div>

          <!-- âœ… Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„: ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø´Ø±Ù -->
          <div class="totals-row" id="deliveryRow" data-admin-only hidden>
            <span id="deliveryFeeLabel">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
            <span id="deliveryFeeValue">0.00</span>
          </div>

          <div class="totals">
            <span id="totalLabel">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
            <span id="totalValue">0.00</span>
          </div>

          <div class="form">
            <!-- âœ… Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„: Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø· -->
            <div class="field" id="deliveryFeeField" data-admin-only hidden>
              <label id="deliveryFeeInputLabel" for="deliveryFeeInput">Ù‚ÙŠÙ…Ø© Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</label>
              <input id="deliveryFeeInput" type="number" min="0" step="1" placeholder="Ù…Ø«Ø§Ù„: 10" />
              <div class="hint" id="deliveryFeeHint">ØªØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ùˆ Ø§Ù„Ù…Ø³Ø§ÙØ©.</div>
            </div>

            <div class="field">
              <label id="nameLabel" for="custName">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="custName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" />
            </div>

            <div class="field">
              <label id="phoneLabel" for="custPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
              <input id="custPhone" type="tel" placeholder="06/07xxxxxxxx" />
            </div>

            <div class="field">
              <label id="addrLabel" for="custAddr">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
              <input id="custAddr" type="text" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠ..." />
            </div>

            <div class="field">
              <label id="notesLabel" for="custNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <textarea id="custNotes" placeholder="Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ØŒ Ø­Ø§Ø±ØŒ ..."></textarea>
            </div>

            <button class="btn ghost" id="getAddrBtn" type="button">ğŸ“ <span id="getAddrText">Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span></button>
            <div class="hint" id="locHint">Ù‚Ø¯ ÙŠØ·Ù„Ø¨ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.</div>

            <!-- âœ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø· -->
            <button class="btn ghost" id="printInvoice" data-admin-only hidden type="button">ğŸ–¨ï¸ <span id="printText">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span></button>
            <button class="btn ghost" id="btPrintInvoice" data-admin-only hidden type="button">ğŸ§¾ğŸ“¶ <span id="btPrintText">Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«</span></button>
            <div class="hint" id="btHint" data-admin-only hidden></div>

            <!-- âœ… Ø²Ø± ÙˆØ§Ø­Ø¯: Ø¹Ù†Ø¯ Ø§Ù„Ø²Ø¨ÙˆÙ† ÙŠØ±Ø³Ù„ Ù„Ù„Ù…Ø´Ø±ÙØŒ ÙˆØ¹Ù†Ø¯ Ø§Ù„Ù…Ø´Ø±Ù ÙŠØ±Ø³Ù„ Ù„Ù„Ù…ÙƒÙ„Ù Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„ -->
            <button class="btn good" id="sendWhatsApp" type="button">ğŸ“² <span id="sendText">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span></button>

            <div class="hint" id="closedHint" style="display:none;color:#b00;font-weight:900">
              Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†.
            </div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <span id="footerText">Â© siymon</span>
    </div>
  </footer>

  <script>
    /***********************
     * âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù… + Ø§Ù„Ù…Ø´Ø±Ù
     ***********************/
    // Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø±Ù/Ø§Ù„Ù…Ø·Ø¹Ù… (Ø§Ù„Ø²Ø¨ÙˆÙ† ÙŠØ±Ø³Ù„ Ù„Ù‡)
    const ADMIN_WHATSAPP_NUMBER   = "212617139424";

    // Ø±Ù‚Ù… Ø§Ù„Ù…ÙƒÙ„Ù Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„ (Ø§Ù„Ù…Ø´Ø±Ù ÙŠØ±Ø³Ù„ Ù„Ù‡)
    const COURIER_WHATSAPP_NUMBER = "212629051769"; // âœ… Ø¨Ø¯Ù„Ù‡Ø§ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚

    const SUPPORT_PHONE   = "+212617139424";
    const CURRENCY_AR = "Ø¯Ø±Ù‡Ù…";
    const CURRENCY_EN = "MAD";

    // âœ… ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø´Ø±Ù (Ø¨Ø¯Ù‘Ù„Ù‡Ø§)
    const ADMIN_PASSWORD = "6789";
    const ADMIN_LS_KEY   = "siymon_is_admin_v1";

    const DEFAULT_DELIVERY_FEE = 10;

    // âœ… Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„
    const BUSINESS = {
      open:  { h: 12, m: 0 },  // 12:00
      close: { h: 0,  m: 0 },  // 00:00
      days:  [0,1,2,3,4,5,6]
    };

    const i18n = {
      ar: {
        dir: "rtl",
        title: "siymon",
        subtitle: "Ø§Ø·Ù„Ø¨ Ø£ÙƒÙ„Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ø¨Ø³Ø±Ø¹Ø©",
        cartTitle: "Ø§Ù„Ø³Ù„Ø©",
        emptyCart: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©. Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ‘‡",

        openNow: "Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†",
        closedNow: "Ù…ØºÙ„Ù‚ Ø§Ù„Ø¢Ù†",
        hoursText: "Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 12:00 Ø¥Ù„Ù‰ 00:00 â€” Ø·ÙŠÙ„Ø© Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹",

        subTotalLabel: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ",
        deliveryFeeLabel: "Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",
        totalLabel: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
        totalNoDeliveryLabel: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† ØªÙˆØµÙŠÙ„)",

        deliveryFeeInputLabel: "Ù‚ÙŠÙ…Ø© Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",
        deliveryFeePlaceholder: "Ù…Ø«Ø§Ù„: 10",
        deliveryFeeHint: "ØªØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ùˆ Ø§Ù„Ù…Ø³Ø§ÙØ©.",

        nameLabel: "Ø§Ù„Ø§Ø³Ù…",
        phoneLabel: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
        addrLabel: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
        notesLabel: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",

        // âœ… Ù†Øµ Ø§Ù„Ø²Ø± Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
        sendAdminText: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…Ø·Ø¹Ù… Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
        sendCourierText: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ù…ÙƒÙ„Ù Ø¨Ø§Ù„ØªÙˆØµÙŠÙ„",

        clearText: "ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©",
        addBtn: "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©",
        categoryAll: "Ø§Ù„ÙƒÙ„",

        getAddrText: "Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",
        locHint: "Ù‚Ø¯ ÙŠØ·Ù„Ø¨ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.",

        printText: "Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©",
        btPrintText: "Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«",

        geo: {
          unsupported: "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹",
          denied: "ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙƒØŒ Ø§Ù„Ù…Ø±Ø¬Ùˆ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹",
          locating: "Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...",
          filled: "ØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ…",
          failed: "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ ØªÙ… ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ø¯Ù„Ù‹Ø§ Ø¹Ù†Ù‡."
        },

        validations: {
          needItems: "Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø³Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹.",
          needName: "Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù…Ù† ÙØ¶Ù„Ùƒ.",
          needPhone: "Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù…Ù† ÙØ¶Ù„Ùƒ.",
          needAddress: "Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ù† ÙØ¶Ù„Ùƒ.",
          closed: "Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†."
        },

        footer: "Â© siymon",
        msg: {
          header: "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† siymon",
          customer: "Ø§Ù„Ø²Ø¨ÙˆÙ†",
          phone: "Ø§Ù„Ù‡Ø§ØªÙ",
          address: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
          notes: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
          items: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
          subtotal: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ",
          deliveryFee: "Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",
          deliveryTbd: "ÙŠØ­Ø¯Ø¯Ù‡Ø§ Ø§Ù„Ù…Ø´Ø±Ù",
          total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
          thanks: "Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ…"
        }
      },
      en: {
        dir: "ltr",
        title: "siymon | Food Ordering",
        subtitle: "Order your favorite food fast",
        cartTitle: "Cart",
        emptyCart: "Cart is empty. Add items from the list ğŸ‘‡",

        openNow: "Open now",
        closedNow: "Closed now",
        hoursText: "Working hours: 12:00 â†’ 00:00 â€” Every day",

        subTotalLabel: "Subtotal",
        deliveryFeeLabel: "Delivery fee",
        totalLabel: "Total",
        totalNoDeliveryLabel: "Total (no delivery)",

        deliveryFeeInputLabel: "Delivery fee amount",
        deliveryFeePlaceholder: "e.g. 10",
        deliveryFeeHint: "Adjust based on distance/city.",

        nameLabel: "Name",
        phoneLabel: "Phone",
        addrLabel: "Address",
        notesLabel: "Notes (optional)",

        sendAdminText: "Send order to restaurant (WhatsApp)",
        sendCourierText: "Send to courier (WhatsApp)",

        clearText: "Clear cart",
        addBtn: "Add to cart",
        categoryAll: "All",

        getAddrText: "Auto-fill address",
        locHint: "Your browser may ask for location permission.",

        printText: "Print invoice",
        btPrintText: "Print via Bluetooth",

        geo: {
          unsupported: "Geolocation is not supported by your browser.",
          denied: "Couldn't get your location. Please allow location access.",
          locating: "Getting your location...",
          filled: "Address filled successfully âœ…",
          failed: "Couldn't fetch address; coordinates were used instead."
        },

        validations: {
          needItems: "Please add items to the cart first.",
          needName: "Please enter your name.",
          needPhone: "Please enter your phone number.",
          needAddress: "Please enter your address.",
          closed: "We are currently closed. You can't place an order now."
        },

        footer: "Â© siymon",
        msg: {
          header: "New order from siymon",
          customer: "Customer",
          phone: "Phone",
          address: "Address",
          notes: "Notes",
          items: "Items",
          subtotal: "Subtotal",
          deliveryFee: "Delivery fee",
          deliveryTbd: "set by admin",
          total: "Total",
          thanks: "Thank you"
        }
      }
    };

    /***********************
     * products
     ***********************/
    const products = [
      { id:"m1", cat:"moroccan", catLabel:{ar:"Ù…ØºØ±Ø¨ÙŠ", en:"Moroccan"}, price:40,
        img:"https://uploads.onecompiler.io/44avb35xn/44azkc7wy/Photoroom-20260120_003048_5.png",
        name:{ar:"Ø·Ø§Ø¬ÙŠÙ† Ø¯Ø¬Ø§Ø¬", en:"Chicken Tagine"},
        desc:{ar:"Ø·Ø§Ø¬ÙŠÙ† Ø¯Ø¬Ø§Ø¬ Ø¨Ø§Ù„Ù„ÙŠÙ…ÙˆÙ† ÙˆØ§Ù„Ø²ÙŠØªÙˆÙ†", en:"Chicken tagine with lemon & olives"} },
      { id:"m2", cat:"moroccan", price:45,
        img:"https://uploads.onecompiler.io/44avb35xn/44azkc7wy/Photoroom-20260120_003048_7.png",
        name:{ar:"ÙƒØ³ÙƒØ³", en:"Couscous"},
        desc:{ar:"ÙƒØ³ÙƒØ³ Ø¨Ø§Ù„Ø®Ø¶Ø± ÙˆØ§Ù„Ù…Ø±Ù‚", en:"Couscous with vegetables"} },

      { id:"i1", cat:"italian", catLabel:{ar:"Ø¥ÙŠØ·Ø§Ù„ÙŠ", en:"Italian"}, price:45,
        img:"https://images.unsplash.com/photo-1521389508051-d7ffb5dc8ff7?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¨ÙŠØªØ²Ø§ Ù…Ø§Ø±ØºØ±ÙŠØªØ§", en:"Margherita Pizza"},
        desc:{ar:"Ø·Ù…Ø§Ø·Ù… + Ø¬Ø¨Ù† + Ø±ÙŠØ­Ø§Ù†", en:"Tomato + cheese + basil"} },
      { id:"i2", cat:"italian", price:40,
        img:"https://images.unsplash.com/photo-1604908554085-2c0a82b1f345?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¨Ø§Ø³ØªØ§ Ø£Ù„ÙØ±ÙŠØ¯Ùˆ", en:"Alfredo Pasta"},
        desc:{ar:"ØµÙ„ØµØ© ÙƒØ±ÙŠÙ…ÙŠØ© ÙˆØ¬Ø¨Ù†", en:"Creamy sauce & cheese"} },

      { id:"a1", cat:"american", catLabel:{ar:"Ø£Ù…Ø±ÙŠÙƒÙŠ", en:"American"}, price:50,
        img:"https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¨Ø±ØºØ± Ù„Ø­Ù…", en:"Beef Burger"},
        desc:{ar:"Ø¨Ø±ØºØ± Ù…Ø¹ Ø¨Ø·Ø§Ø·Ø³", en:"Burger with fries"} },
      { id:"a2", cat:"american", price:30,
        img:"https://images.unsplash.com/photo-1604908176997-125f25cc5002?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¯Ø¬Ø§Ø¬ Ù…Ù‚Ø±Ù…Ø´", en:"Crispy Chicken"},
        desc:{ar:"Ù‚Ø·Ø¹ Ø¯Ø¬Ø§Ø¬ Ù…Ù‚Ø±Ù…Ø´Ø©", en:"Crispy chicken bites"} },

      { id:"h1", cat:"indian", catLabel:{ar:"Ù‡Ù†Ø¯ÙŠ", en:"Indian"}, price:55,
        img:"https://uploads.onecompiler.io/44avb35xn/44azkc7wy/Photoroom-20260120_003048_2.png",
        name:{ar:"Ø¯Ø¬Ø§Ø¬ ØªÙŠÙƒØ§ Ù…Ø§Ø³Ø§Ù„Ø§", en:"Chicken Tikka Masala"},
        desc:{ar:"ØµÙ„ØµØ© Ù…ØªØ¨Ù„Ø© ÙˆÙƒØ±ÙŠÙ…ÙŠØ©", en:"Spiced creamy sauce"} },
      { id:"h2", cat:"indian", price:20,
        img:"https://images.unsplash.com/photo-1625944522862-37c4f97e3b16?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¨Ø±ÙŠØ§Ù†ÙŠ Ø¯Ø¬Ø§Ø¬", en:"chicken bryani"},
        desc:{ar:"Ø§Ø±Ø² Ù‡Ù†Ø¯ÙŠ Ø·Ø±ÙŠ", en:"Soft Indian ric"} },

      { id:"j1", cat:"water", price:3,
        img:"https://images.unsplash.com/photo-1542444459-db63c3c0e3b4?auto=format&fit=crop&w=900&q=70",
        name:{ ar:"Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„", en:"Orange Juice" },
        desc:{ ar:"ÙƒØ§Ø³ Ø¹ØµÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ", en:"Fresh orange juice" } },

      { id:"s3", cat:"soda", price:8,
        img:"https://uploads.onecompiler.io/44avb35xn/44azkc7wy/lkj%5Ehj%20(5).png",
        name:{ ar:"ÙØ§Ù†ØªØ§", en:"fanta" },
        desc:{ ar:"Ù…Ø´Ø±ÙˆØ¨ ØºØ§Ø²ÙŠ 35ml", en:"soft drink" } },

      { id:"s2", cat:"soda", price:8,
        img:"https://uploads.onecompiler.io/44avb35xn/44azkc7wy/lkj%5Ehj%20(4).png",
        name:{ ar:"Ø³Ø¨Ø±ÙŠØª", en:"Sprite" },
        desc:{ ar:"Ù…Ø´Ø±ÙˆØ¨ ØºØ§Ø²ÙŠ 35ml", en:"soft drink" } },

      { id:"s1", cat:"soda", catLabel:{ar:"Ù…Ø´Ø±ÙˆØ¨Ø§Øª ØºØ§Ø²ÙŠØ©", en:"Soda"}, price:8,
        img:"https://uploads.onecompiler.io/44avb35xn/44azkc7wy/lkj%5Ehj%20(8).png",
        name:{ar:"ÙƒÙˆÙƒØ§ ÙƒÙˆÙ„Ø§", en:"coca cola"},
        desc:{ar:"Ø¹Ù„Ø¨Ø© 330ml", en:"Can 330ml"} },

      { id:"w1", cat:"water", catLabel:{ar:"Ù…ÙŠØ§Ù‡", en:"Water"}, price:6,
        img:"https://uploads.onecompiler.io/44avb35xn/44azkc7wy/Photoroom-20260120_003048_1.png",
        name:{ar:"Ù…Ø§Ø¡ Ù…Ø¹Ø¯Ù†ÙŠ", en:"Mineral Water"},
        desc:{ar:"Ù‚Ø§Ø±ÙˆØ±Ø© 500ml", en:"Bottle 500ml"} }
    ];

    /***********************
     * State + Elements
     ***********************/
    let lang = "ar";
    let activeCat = "all";
    const cart = new Map();

    let isAdmin = false;

    const el = (id) => document.getElementById(id);

    const productsGrid = el("productsGrid");
    const cartItems = el("cartItems");
    const categoryChips = el("categoryChips");

    const subTotalValue = el("subTotalValue");
    const deliveryFeeValue = el("deliveryFeeValue");
    const totalValue = el("totalValue");
    const cartCount = el("cartCount");

    const openBadge = el("openBadge");
    const openText  = el("openText");
    const hoursText = el("hoursText");

    const langToggle = el("langToggle");
    const themeToggle = el("themeToggle");
    const installBtn = el("installBtn");
    const supportCall = el("supportCall");
    const adminBtn = el("adminBtn");

    const clearCartBtn = el("clearCart");
    const goCartBtn = el("goCart");
    const sendBtn = el("sendWhatsApp");

    const getAddrBtn = el("getAddrBtn");
    const locHint = el("locHint");

    const printBtn = el("printInvoice");
    const btPrintBtn = el("btPrintInvoice");
    const btHint = el("btHint");

    const closedHint = el("closedHint");

    const deliveryFeeInput = el("deliveryFeeInput");

    const custName = el("custName");
    const custPhone = el("custPhone");
    const custAddr = el("custAddr");
    const custNotes = el("custNotes");

    /***********************
     * âœ… Admin mode helpers
     ***********************/
    function loadAdminState(){
      isAdmin = localStorage.getItem(ADMIN_LS_KEY) === "1";
    }
    function setAdminState(v){
      isAdmin = !!v;
      localStorage.setItem(ADMIN_LS_KEY, isAdmin ? "1" : "0");
      applyAdminUI();
      renderAll();
      saveCart();
    }
    function applyAdminUI(){
      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø´Ø±Ù
      document.querySelectorAll("[data-admin-only]").forEach(node => {
        node.hidden = !isAdmin;
      });

      // Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„: Ø§Ù„Ø²Ø¨ÙˆÙ† Ù…Ø§ ÙŠÙ‚Ø¯Ø±Ø´ ÙŠØ¨Ø¯Ù„Ù‡Ø§
      if(!isAdmin){
        deliveryFeeInput.value = "0";
        deliveryFeeInput.disabled = true;
      }else{
        deliveryFeeInput.disabled = false;
        if(!deliveryFeeInput.value) deliveryFeeInput.value = String(DEFAULT_DELIVERY_FEE);
      }

      // Ø²Ø± Ø§Ù„Ù‚ÙÙ„: ÙŠØ¨ÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©
      adminBtn.textContent = isAdmin ? "ğŸ”“" : "ğŸ”’";
    }

    adminBtn.addEventListener("click", ()=>{
      if(isAdmin){
        const ok = confirm(lang==="ar" ? "Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø±ÙØŸ" : "Logout admin mode?");
        if(ok) setAdminState(false);
        return;
      }
      const pass = prompt(lang==="ar" ? "Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø´Ø±Ù:" : "Enter admin password:");
      if(pass === null) return;
      if(pass === ADMIN_PASSWORD){
        setAdminState(true);
      }else{
        alert(lang==="ar" ? "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©." : "Wrong password.");
      }
    });

    /***********************
     * âœ… Theme
     ***********************/
    const THEME_KEY = "siymon_theme_v2";
    function applyTheme(theme){
      if(theme === "dark"){
        document.documentElement.setAttribute("data-theme", "dark");
        themeToggle.textContent = "â˜€ï¸";
      }else{
        document.documentElement.removeAttribute("data-theme");
        themeToggle.textContent = "ğŸŒ™";
      }
    }
    function loadTheme(){
      const saved = localStorage.getItem(THEME_KEY);
      if(saved){ applyTheme(saved); return; }
      const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      applyTheme(prefersDark ? "dark" : "light");
    }
    function toggleTheme(){
      const isDark = document.documentElement.getAttribute("data-theme") === "dark";
      const next = isDark ? "light" : "dark";
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    }
    themeToggle.addEventListener("click", toggleTheme);

    /***********************
     * âœ… LocalStorage
     ***********************/
    const LS_KEY = "siymon_cart_v4";
    function saveCart(){
      const obj = {
        lang,
        items: Array.from(cart.entries()),
        activeCat,
        deliveryFee: deliveryFeeInput.value || "",
        customer: {
          name: custName.value || "",
          phone: custPhone.value || "",
          addr: custAddr.value || "",
          notes: custNotes.value || ""
        }
      };
      localStorage.setItem(LS_KEY, JSON.stringify(obj));
    }

    function loadCart(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const obj = JSON.parse(raw);

        if(obj?.lang) lang = obj.lang;
        if(obj?.activeCat) activeCat = obj.activeCat;
        if(typeof obj?.deliveryFee === "string") deliveryFeeInput.value = obj.deliveryFee;

        if(Array.isArray(obj?.items)){
          cart.clear();
          obj.items.forEach(([id, qty])=>{
            if(typeof id==="string" && Number.isFinite(qty) && qty>0) cart.set(id, qty);
          });
        }

        if(obj?.customer){
          custName.value = obj.customer.name || "";
          custPhone.value = obj.customer.phone || "";
          custAddr.value = obj.customer.addr || "";
          custNotes.value = obj.customer.notes || "";
        }
      }catch(e){}
    }

    /***********************
     * Helpers
     ***********************/
    function money(v){
      const num = Number(v || 0);
      return num.toFixed(2) + " " + (lang==="ar" ? CURRENCY_AR : CURRENCY_EN);
    }
    function getProduct(id){ return products.find(p => p.id === id); }
    function cartSubTotal(){
      let total = 0;
      for(const [id, qty] of cart.entries()){
        const p = getProduct(id);
        if(p) total += p.price * qty;
      }
      return total;
    }
    function getDeliveryFee(){
      const n = Number(deliveryFeeInput.value || DEFAULT_DELIVERY_FEE || 0);
      return Number.isFinite(n) && n >= 0 ? n : 0;
    }
    function effectiveDeliveryFee(){
      // âœ… Ø§Ù„Ø²Ø¨ÙˆÙ†: 0 / Ø§Ù„Ù…Ø´Ø±Ù: Ø­Ø³Ø¨ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
      return isAdmin ? getDeliveryFee() : 0;
    }
    function cartGrandTotal(){ return cartSubTotal() + effectiveDeliveryFee(); }
    function cartItemsCount(){
      let c = 0;
      for(const qty of cart.values()) c += qty;
      return c;
    }

    /***********************
     * âœ… Business hours (FIXED 00:00 issue)
     ***********************/
    function isBusinessOpen(now = new Date()){
      const day = now.getDay();
      const minutesNow = now.getHours()*60 + now.getMinutes();

      const isDayAllowed = (d) => BUSINESS.days.includes(d);

      const openMin  = (BUSINESS.open.h*60)  + BUSINESS.open.m;
      let closeMin   = (BUSINESS.close.h*60) + BUSINESS.close.m;

      if(closeMin === 0 && openMin > 0){
        closeMin = 24*60;
      }

      if(closeMin === openMin){
        return isDayAllowed(day);
      }

      const overnight = closeMin < openMin;

      if(!overnight){
        return isDayAllowed(day) && minutesNow >= openMin && minutesNow < closeMin;
      }

      if(minutesNow < closeMin){
        const prevDay = (day + 6) % 7;
        return isDayAllowed(prevDay);
      }
      return isDayAllowed(day) && minutesNow >= openMin;
    }

    function updateOpenStatus(){
      const open = isBusinessOpen(new Date());
      openBadge.classList.toggle("open", open);
      openBadge.classList.toggle("closed", !open);

      openText.textContent = open ? i18n[lang].openNow : i18n[lang].closedNow;
      hoursText.textContent = i18n[lang].hoursText;

      sendBtn.disabled = !open;
      closedHint.style.display = open ? "none" : "block";
    }

    /***********************
     * i18n apply
     ***********************/
    function applyI18n(){
      document.documentElement.lang = lang;
      document.documentElement.dir = i18n[lang].dir;
      document.title = i18n[lang].title;

      el("subtitle").textContent = i18n[lang].subtitle;

      el("cartTitle").textContent = i18n[lang].cartTitle;
      el("subTotalLabel").textContent = i18n[lang].subTotalLabel;

      // labels Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
      el("totalLabel").textContent = isAdmin ? i18n[lang].totalLabel : i18n[lang].totalNoDeliveryLabel;

      // Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆØ±
      el("sendText").textContent = isAdmin ? i18n[lang].sendCourierText : i18n[lang].sendAdminText;

      // admin-only labels (Ø¥Ø°Ø§ Ø¸Ø§Ù‡Ø±ÙŠÙ†)
      el("deliveryFeeLabel").textContent = i18n[lang].deliveryFeeLabel;
      el("deliveryFeeInputLabel").textContent = i18n[lang].deliveryFeeInputLabel;
      deliveryFeeInput.placeholder = i18n[lang].deliveryFeePlaceholder;
      el("deliveryFeeHint").textContent = i18n[lang].deliveryFeeHint;

      el("nameLabel").textContent = i18n[lang].nameLabel;
      el("phoneLabel").textContent = i18n[lang].phoneLabel;
      el("addrLabel").textContent = i18n[lang].addrLabel;
      el("notesLabel").textContent = i18n[lang].notesLabel;

      el("printText").textContent = i18n[lang].printText;
      el("btPrintText").textContent = i18n[lang].btPrintText;

      el("getAddrText").textContent = i18n[lang].getAddrText;
      locHint.textContent = i18n[lang].locHint;

      el("clearText").textContent = i18n[lang].clearText;
      el("footerText").textContent = i18n[lang].footer;

      langToggle.textContent = (lang === "ar") ? "EN" : "AR";

      custName.placeholder = (lang==="ar") ? "Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" : "e.g. John";
      custPhone.placeholder = (lang==="ar") ? "06/07xxxxxxxx" : "Phone number";
      custAddr.placeholder = (lang==="ar") ? "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠ..." : "City, street...";
      custNotes.placeholder = (lang==="ar") ? "Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ØŒ Ø­Ø§Ø±ØŒ ..." : "No onions, spicy, ...";

      supportCall.setAttribute("href", "tel:" + SUPPORT_PHONE);

      updateOpenStatus();
    }

    /***********************
     * Categories auto
     ***********************/
    function buildCategoriesFromProducts(){
      const map = new Map();
      for(const p of products){
        if(!p?.cat) continue;
        if(map.has(p.cat)) continue;
        const label = p.catLabel || { ar: p.cat, en: p.cat };
        map.set(p.cat, label);
      }
      return Array.from(map.entries()).map(([key, label]) => ({
        key,
        label: (label && (label[lang] || label.en || label.ar)) || key
      }));
    }

    function normalizeActiveCat(){
      if(activeCat === "all") return;
      const cats = buildCategoriesFromProducts().map(c => c.key);
      if(!cats.includes(activeCat)) activeCat = "all";
    }

    function renderCategories(){
      normalizeActiveCat();
      const cats = buildCategoriesFromProducts();
      const list = [{ key:"all", label: i18n[lang].categoryAll }, ...cats];

      categoryChips.innerHTML = "";
      list.forEach(c=>{
        const btn = document.createElement("div");
        btn.className = "chip" + (activeCat===c.key ? " active" : "");
        btn.textContent = c.label;
        btn.addEventListener("click", ()=>{
          activeCat = c.key;
          renderAll();
          saveCart();
        });
        categoryChips.appendChild(btn);
      });
    }

    function renderProducts(){
      const filtered = (activeCat==="all") ? products : products.filter(p => p.cat === activeCat);
      productsGrid.innerHTML = "";

      filtered.forEach(p=>{
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="img">
            <img src="${p.img}" alt="${p.name[lang]}" loading="lazy"
              onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22600%22 height=%22400%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23eee%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22 font-family=%22Arial%22 font-size=%2220%22>Image</text></svg>';"/>
          </div>
          <h3>${p.name[lang]}</h3>
          <p>${p.desc[lang]}</p>
          <div class="row">
            <span class="price">${money(p.price)}</span>
          </div>
          <button class="btn primary add addBtn" data-id="${p.id}" type="button">â• ${i18n[lang].addBtn}</button>
        `;
        productsGrid.appendChild(card);
      });

      document.querySelectorAll(".addBtn").forEach(b=>{
        b.addEventListener("click", ()=>{
          const id = b.getAttribute("data-id");
          addToCart(id, 1);
        });
      });
    }

    function renderCart(){
      cartItems.innerHTML = "";

      if(cart.size === 0){
        cartItems.innerHTML = `<div class="empty">${i18n[lang].emptyCart}</div>`;
      }else{
        for(const [id, qty] of cart.entries()){
          const p = getProduct(id);
          if(!p) continue;

          const subtotal = p.price * qty;
          const item = document.createElement("div");
          item.className = "cart-item";
          item.innerHTML = `
            <div>
              <b>${p.name[lang]}</b>
              <small>${money(p.price)} â€¢ <span class="muted">${money(subtotal)}</span></small>
            </div>
            <div class="qty">
              <button type="button" data-act="minus" data-id="${id}">âˆ’</button>
              <span>${qty}</span>
              <button type="button" data-act="plus" data-id="${id}">+</button>
            </div>
          `;
          cartItems.appendChild(item);
        }

        cartItems.querySelectorAll("button").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const act = btn.getAttribute("data-act");
            const id = btn.getAttribute("data-id");
            if(act==="plus") addToCart(id, 1);
            if(act==="minus") addToCart(id, -1);
          });
        });
      }

      const sub = cartSubTotal();
      const fee = effectiveDeliveryFee();
      const grand = cartGrandTotal();

      subTotalValue.textContent = money(sub);
      deliveryFeeValue.textContent = money(fee);
      totalValue.textContent = money(grand);

      cartCount.textContent = String(cartItemsCount());

      // Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ø­Ù…ÙŠØ© Ø­ØªÙ‰ Ù„Ùˆ Ø­Ø§ÙˆÙ„ Ø­Ø¯ ÙŠÙ†Ø§Ø¯ÙŠÙ‡Ø§
      printBtn.disabled = (cart.size === 0) || (!isAdmin);
      btPrintBtn.disabled = (cart.size === 0) || (!isAdmin);

      updateOpenStatus();
    }

    function renderAll(){
      applyI18n();
      renderCategories();
      renderProducts();
      renderCart();
    }

    function addToCart(id, delta){
      const p = getProduct(id);
      if(!p) return;

      const cur = cart.get(id) || 0;
      const next = cur + delta;

      if(next <= 0) cart.delete(id);
      else cart.set(id, next);

      renderCart();
      saveCart();
    }

    function clearCart(){
      cart.clear();
      renderCart();
      saveCart();
    }

    /***********************
     * Geolocation
     ***********************/
    async function getLocation(){
      if(!navigator.geolocation){
        alert(i18n[lang].geo.unsupported);
        return;
      }

      getAddrBtn.disabled = true;
      const oldText = el("getAddrText").textContent;
      el("getAddrText").textContent = i18n[lang].geo.locating;

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        try{
          const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`;
          const res = await fetch(url, {
            headers: { "Accept": "application/json", "Accept-Language": (lang === "ar") ? "ar" : "en" }
          });
          const data = await res.json();
          const display = (data && data.display_name) ? data.display_name : `Lat: ${lat}, Lng: ${lng}`;

          custAddr.value = display;
          custAddr.dispatchEvent(new Event("input", { bubbles:true }));
          locHint.textContent = i18n[lang].geo.filled;
        }catch(e){
          custAddr.value = `Lat: ${lat}, Lng: ${lng}`;
          custAddr.dispatchEvent(new Event("input", { bubbles:true }));
          locHint.textContent = i18n[lang].geo.failed;
        }finally{
          getAddrBtn.disabled = false;
          el("getAddrText").textContent = oldText;
        }
      }, () => {
        alert(i18n[lang].geo.denied);
        getAddrBtn.disabled = false;
        el("getAddrText").textContent = oldText;
      }, { enableHighAccuracy:true, timeout:10000, maximumAge:0 });
    }

    /***********************
     * WhatsApp
     ***********************/
    function buildWhatsAppMessage(){
      const tr = i18n[lang].msg;

      if(!isBusinessOpen(new Date())) return { error: i18n[lang].validations.closed };

      const name  = custName.value.trim();
      const phone = custPhone.value.trim();
      const addr  = custAddr.value.trim();
      const notes = custNotes.value.trim();

      if(cart.size === 0) return { error: i18n[lang].validations.needItems };
      if(!name)  return { error: i18n[lang].validations.needName };
      if(!phone) return { error: i18n[lang].validations.needPhone };
      if(!addr)  return { error: i18n[lang].validations.needAddress };

      const lines = [];
      lines.push(`ğŸ§¾ ${tr.header}`);
      lines.push(`----------------------`);
      lines.push(`ğŸ‘¤ ${tr.customer}: ${name}`);
      lines.push(`ğŸ“ ${tr.phone}: ${phone}`);
      lines.push(`ğŸ“ ${tr.address}: ${addr}`);
      if(notes) lines.push(`ğŸ“ ${tr.notes}: ${notes}`);
      lines.push(`----------------------`);
      lines.push(`ğŸ›’ ${tr.items}:`);

      for(const [id, qty] of cart.entries()){
        const p = getProduct(id);
        if(!p) continue;
        const subtotal = p.price * qty;
        lines.push(`- ${p.name[lang]} Ã— ${qty} = ${money(subtotal)}`);
      }

      const sub = cartSubTotal();
      const fee = effectiveDeliveryFee();
      const grand = cartGrandTotal();

      lines.push(`----------------------`);
      lines.push(`ğŸ§® ${tr.subtotal}: ${money(sub)}`);

      // âœ… Ø§Ù„Ø²Ø¨ÙˆÙ†: Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ù…Ø¨Ù„Øº Ø§Ù„ØªÙˆØµÙŠÙ„ (ÙŠØ­Ø¯Ø¯Ù‡ Ø§Ù„Ù…Ø´Ø±Ù)
      if(isAdmin){
        lines.push(`ğŸšš ${tr.deliveryFee}: ${money(fee)}`);
      }else{
        lines.push(`ğŸšš ${tr.deliveryFee}: ${tr.deliveryTbd}`);
      }

      lines.push(`ğŸ’° ${tr.total}: ${money(grand)}`);
      lines.push(`ğŸ™ ${tr.thanks}`);

      return { text: lines.join("\n") };
    }

    function sendToWhatsApp(){
      const msg = buildWhatsAppMessage();
      if(msg.error){ alert(msg.error); return; }

      const number = isAdmin ? COURIER_WHATSAPP_NUMBER : ADMIN_WHATSAPP_NUMBER;
      const url = `https://wa.me/${number}?text=${encodeURIComponent(msg.text)}`;
      window.open(url, "_blank");
    }

    /***********************
     * Print (popup) â€” âœ… Admin only
     ***********************/
    function buildInvoiceHTML(){
      const tr = i18n[lang].msg;
      const now = new Date();
      const dateStr = now.toLocaleString(lang === "ar" ? "ar-MA" : "en-US");

      const name  = custName.value.trim();
      const phone = custPhone.value.trim();
      const addr  = custAddr.value.trim();
      const notes = custNotes.value.trim();

      const sub = cartSubTotal();
      const fee = effectiveDeliveryFee();
      const grand = cartGrandTotal();

      const rows = Array.from(cart.entries()).map(([id, qty])=>{
        const p = getProduct(id);
        if(!p) return "";
        const lineTotal = p.price * qty;
        return `
          <tr>
            <td>${p.name[lang]}</td>
            <td style="text-align:center">${qty}</td>
            <td style="text-align:center">${money(p.price)}</td>
            <td style="text-align:center">${money(lineTotal)}</td>
          </tr>
        `;
      }).join("");

      return `
<!doctype html>
<html lang="${lang}" dir="${i18n[lang].dir}">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Invoice</title>
<style>
  body{font-family:Arial, sans-serif; padding:20px; color:#111}
  h1{margin:0;font-size:18px}
  .muted{color:#666;font-size:12px;margin-top:4px}
  table{width:100%;border-collapse:collapse;margin-top:14px}
  th,td{border:1px solid #ddd;padding:8px;font-size:13px}
  th{background:#f6f6f6}
  .totals{margin-top:12px; max-width:420px; margin-inline-start:auto}
  .totals div{display:flex; justify-content:space-between; padding:6px 0; font-weight:700}
  .totals .grand{border-top:2px solid #111; padding-top:10px}
  .box{margin-top:12px; padding:10px; border:1px solid #ddd; border-radius:10px}
  .btn{margin-top:14px; padding:10px 12px; border:1px solid #111; background:#fff; cursor:pointer; border-radius:10px; font-weight:700}
  @media print{ .btn{display:none} body{padding:0} }
</style>
</head>
<body>
  <h1>siymon</h1>
  <div class="muted">${dateStr}</div>

  <div class="box">
    <div><b>${tr.customer}:</b> ${name || "-"}</div>
    <div><b>${tr.phone}:</b> ${phone || "-"}</div>
    <div><b>${tr.address}:</b> ${addr || "-"}</div>
    <div><b>${tr.notes}:</b> ${notes || "-"}</div>
  </div>

  <table>
    <thead>
      <tr>
        <th>${tr.items}</th>
        <th style="width:70px;text-align:center">Qty</th>
        <th style="width:120px;text-align:center">Price</th>
        <th style="width:140px;text-align:center">Total</th>
      </tr>
    </thead>
    <tbody>${rows}</tbody>
  </table>

  <div class="totals">
    <div><span>${tr.subtotal}</span><span>${money(sub)}</span></div>
    <div><span>${tr.deliveryFee}</span><span>${money(fee)}</span></div>
    <div class="grand"><span>${tr.total}</span><span>${money(grand)}</span></div>
  </div>

  <button class="btn" onclick="window.print()">${lang==="ar" ? "Ø·Ø¨Ø§Ø¹Ø©" : "Print"}</button>
</body>
</html>
      `.trim();
    }

    function printInvoice(){
      if(!isAdmin){
        alert(lang==="ar" ? "Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø´Ø±Ù ÙÙ‚Ø·." : "Printing is admin-only.");
        return;
      }
      if(cart.size === 0){ alert(i18n[lang].validations.needItems); return; }
      const html = buildInvoiceHTML();
      const w = window.open("", "_blank");
      if(!w){
        alert(lang==="ar" ? "Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©. Ø§Ø³Ù…Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©." : "Popup blocked. Please allow popups.");
        return;
      }
      w.document.open();
      w.document.write(html);
      w.document.close();
    }

    /***********************
     * PWA Install
     ***********************/
    let deferredPrompt = null;
    function isIOS(){ return /iphone|ipad|ipod/i.test(navigator.userAgent); }

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = "inline-flex";
    });

    installBtn.addEventListener("click", async () => {
      if(!deferredPrompt){
        if(isIOS()) alert(lang==="ar" ? "ÙÙŠ iPhone: Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø«Ù… (Add to Home Screen)." : "On iPhone: tap Share then Add to Home Screen.");
        return;
      }
      deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.style.display = "none";
    });

    if("serviceWorker" in navigator){
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(()=>{});
      });
    }

    /***********************
     * Events
     ***********************/
    langToggle.addEventListener("click", ()=>{
      lang = (lang === "ar") ? "en" : "ar";
      renderAll();
      saveCart();
    });

    clearCartBtn.addEventListener("click", clearCart);

    goCartBtn.addEventListener("click", ()=>{
      document.getElementById("cartPanel").scrollIntoView({behavior:"smooth", block:"start"});
    });

    sendBtn.addEventListener("click", sendToWhatsApp);
    getAddrBtn.addEventListener("click", getLocation);
    printBtn.addEventListener("click", printInvoice);

    deliveryFeeInput.addEventListener("input", ()=>{
      renderCart();
      saveCart();
    });

    [custName, custPhone, custAddr, custNotes].forEach(input=>{
      input.addEventListener("input", ()=> saveCart());
    });

    /***********************
     * Init
     ***********************/
    loadAdminState();
    loadCart();

    loadTheme();
    applyAdminUI();

    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø´Ø±Ù: Ø¶Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„
    if(isAdmin && !deliveryFeeInput.value) deliveryFeeInput.value = String(DEFAULT_DELIVERY_FEE);

    renderAll();
    setInterval(()=> updateOpenStatus(), 60_000);
  </script>
</body>
</html>
