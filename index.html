<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>siymon | ØµÙØ­Ø© Ù‡Ø¨ÙˆØ· Ù„Ø·Ù„Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù…</title>

  <style>
    :root{
      --bg:#F7F4EF;
      --card:#ffffff;
      --text:#111;
      --muted:#666;
      --brand:#ff5722;
      --brand2:#1f8a70;
      --shadow:0 6px 18px rgba(0,0,0,.10);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.5;
    }

    header{
      position:sticky; top:0; z-index:50;
      background:rgba(247,244,239,.92);
      backdrop-filter: blur(8px);
      border-bottom:1px solid rgba(0,0,0,.06);
    }

    .wrap{width:min(1150px, 92%); margin:auto}

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
      gap:12px;
      flex-wrap:wrap;
    }

    .brand{display:flex; align-items:center; gap:12px;}
    .logo-img{
      width:50px;
      height:50px;
      border-radius:14px;
      object-fit:contain;
      box-shadow: var(--shadow);
      background:#000;
      padding:6px;
    }
    .brand h1{margin:0; font-size:20px; letter-spacing:.4px;}
    .brand p{margin:0; color:var(--muted); font-size:13px}

    .actions{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}

    .btn{
      border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      background:#fff;
      box-shadow: 0 2px 10px rgba(0,0,0,.06);
      color:#111;
      font-weight:600;
      transition:.15s transform ease, .15s opacity ease;
      display:inline-flex; align-items:center; gap:8px;
      white-space:nowrap;
      justify-content:center;
    }
    .btn:active{transform:scale(.98)}
    .btn.primary{background:var(--brand); color:#fff}
    .btn.good{background:var(--brand2); color:#fff}
    .btn.ghost{background:transparent; box-shadow:none; border:1px solid rgba(0,0,0,.10)}
    .btn:disabled{opacity:.65; cursor:not-allowed}

    .statusbar{
      display:flex;
      gap:10px;
      align-items:center;
      padding:0 0 14px 0;
      flex-wrap:wrap;
    }
    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
      font-weight:800;
      font-size:13px;
    }
    .dot{
      width:10px;
      height:10px;
      border-radius:50%;
      background:#bbb;
      display:inline-block;
    }
    .badge.open .dot{ background: var(--brand2); }
    .badge.closed .dot{ background: #d33; }
    .status-text{color:var(--muted); font-size:12px}

    .chips{
      display:flex; gap:10px; flex-wrap:wrap;
      padding:0 0 10px 0;
    }
    .chip{
      padding:9px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      cursor:pointer;
      font-weight:700;
      color:#222;
      box-shadow: 0 2px 10px rgba(0,0,0,.04);
      user-select:none;
    }
    .chip.active{
      border-color: rgba(255,87,34,.35);
      box-shadow: 0 8px 18px rgba(255,87,34,.12);
      color: var(--brand);
    }

    main{padding:18px 0 40px}

    .layout{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1.6fr .9fr;
      gap:18px;
      align-items:start;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:14px;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:12px;
      display:flex;
      flex-direction:column;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.05);
    }
    .img{
      width:100%;
      height:150px;
      border-radius:14px;
      background:#eee;
      overflow:hidden;
    }
    .img img{width:100%; height:100%; object-fit:cover; display:block}
    .card h3{margin:10px 0 2px 0; font-size:16px}
    .card p{margin:0; color:var(--muted); font-size:13px; min-height:38px}
    .row{display:flex; justify-content:space-between; align-items:center; margin-top:10px; gap:10px;}
    .price{font-weight:900}
    .add{width:100%}

    .side{position:sticky; top:90px;}

    .panel{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      border:1px solid rgba(0,0,0,.05);
    }
    .panel h3{margin:0 0 10px 0}
    .cart-items{display:flex; flex-direction:column; gap:10px; margin:10px 0}
    .cart-item{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
      padding:10px;
      background:#fff;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.06);
    }
    .cart-item b{display:block}
    .cart-item small{color:var(--muted)}
    .qty{display:flex; align-items:center; gap:8px; justify-content:flex-end;}
    .qty button{
      width:34px; height:34px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      cursor:pointer;
      font-weight:900;
    }
    .qty span{min-width:18px; text-align:center; font-weight:900}

    .totals-row{
      display:flex; justify-content:space-between; align-items:center;
      margin-top:8px;
      font-weight:900;
    }
    .totals{
      border-top:1px dashed rgba(0,0,0,.18);
      padding-top:10px;
      display:flex; justify-content:space-between; align-items:center;
      margin-top:10px;
      font-weight:900;
    }

    .form{margin-top:12px; display:grid; gap:10px;}
    .field label{display:block; font-weight:800; font-size:13px; margin-bottom:6px}
    .field input, .field textarea{
      width:100%;
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      background:#fff;
      font-size:14px;
    }
    .field textarea{min-height:70px; resize:vertical}

    .hint{font-size:12px; color:var(--muted); margin-top:6px}
    .muted{color:var(--muted)}
    .empty{
      padding:12px;
      border-radius:14px;
      border:1px dashed rgba(0,0,0,.2);
      color:var(--muted);
      text-align:center;
      background:rgba(255,255,255,.6);
    }

    footer{
      padding:18px 0 30px;
      color:var(--muted);
      font-size:12px;
      text-align:center;
    }

    @media (max-width: 980px){
      .layout{grid-template-columns:1fr}
      .side{position:static}
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <img class="logo-img"
               src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Photoroom-20260117_132534545.png"
               alt="siymon logo" />
          <div>
            <h1>siymon</h1>
            <p id="subtitle">Ø§Ø·Ù„Ø¨ Ø£ÙƒÙ„Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ø¨Ø³Ø±Ø¹Ø©</p>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="langToggle" type="button">EN</button>
          <button class="btn" id="clearCart" type="button">ğŸ§¹ <span id="clearText">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</span></button>
          <button class="btn primary" id="goCart" type="button">ğŸ›’ <span id="cartCount">0</span></button>
        </div>
      </div>

      <div class="statusbar">
        <span id="openBadge" class="badge">
          <span class="dot"></span>
          <span id="openText">...</span>
        </span>
        <span id="hoursText" class="status-text"></span>
      </div>

      <div class="chips" id="categoryChips"></div>
    </div>
  </header>

  <main class="wrap">
    <section class="layout">
      <div>
        <div class="grid" id="productsGrid"></div>
      </div>

      <aside class="side">
        <div class="panel" id="cartPanel">
          <h3 id="cartTitle">Ø§Ù„Ø³Ù„Ø©</h3>
          <div id="cartItems" class="cart-items"></div>

          <div class="totals-row">
            <span id="subTotalLabel">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
            <span id="subTotalValue">0.00</span>
          </div>
          <div class="totals-row">
            <span id="deliveryFeeLabel">Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span>
            <span id="deliveryFeeValue">0.00</span>
          </div>
          <div class="totals">
            <span id="totalLabel">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
            <span id="totalValue">0.00</span>
          </div>

          <div class="form">
            <div class="field">
              <label id="deliveryFeeInputLabel" for="deliveryFeeInput">Ù‚ÙŠÙ…Ø© Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</label>
              <input id="deliveryFeeInput" type="number" min="0" step="1" placeholder="Ù…Ø«Ø§Ù„: 10" />
              <div class="hint" id="deliveryFeeHint">ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù…Ø³Ø§ÙØ©.</div>
            </div>

            <div class="field">
              <label id="nameLabel" for="custName">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="custName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" />
            </div>

            <div class="field">
              <label id="phoneLabel" for="custPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
              <input id="custPhone" type="tel" placeholder="06xxxxxxxx" />
            </div>

            <div class="field">
              <label id="addrLabel" for="custAddr">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
              <input id="custAddr" type="text" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠ..." />
            </div>

            <div class="field">
              <label id="notesLabel" for="custNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <textarea id="custNotes" placeholder="Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ØŒ Ø­Ø§Ø±ØŒ ..."></textarea>
            </div>

            <button class="btn ghost" id="getAddrBtn" type="button">ğŸ“ <span id="getAddrText">Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span></button>
            <div class="hint" id="locHint">Ù‚Ø¯ ÙŠØ·Ù„Ø¨ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.</div>

            <button class="btn ghost" id="printInvoice" type="button">ğŸ–¨ï¸ <span id="printText">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</span></button>
            <button class="btn ghost" id="btPrintInvoice" type="button">ğŸ§¾ğŸ“¶ <span id="btPrintText">Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«</span></button>

            <button class="btn good" id="sendWhatsApp" type="button">ğŸ“² <span id="sendText">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</span></button>

            <div class="hint" id="closedHint" style="display:none;color:#b00;font-weight:800">
              Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†.
            </div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <footer>
    <div class="wrap">
      <span id="footerText">Â© siymon</span>
    </div>
  </footer>

  <script>
    const WHATSAPP_NUMBER = "212600000000";
    const CURRENCY_AR = "Ø¯Ø±Ù‡Ù…";
    const CURRENCY_EN = "MAD";

    const DEFAULT_DELIVERY_FEE = 10;

    // âœ… Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: Ø§Ù„Ø£Ø­Ø¯ ÙˆØ§Ù„Ø§Ø«Ù†ÙŠÙ† ÙÙ‚Ø·
    // Ù…Ù„Ø§Ø­Ø¸Ø©: 12:00 Ø¥Ù„Ù‰ 00:00 (ÙŠÙ…ØªØ¯ Ù„Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„)
    const BUSINESS = {
      open:  { h: 12, m: 0 },
      close: { h: 0,  m: 0 },
      days:  [0, 1] // Sunday, Monday
    };

    const i18n = {
      ar: {
        dir: "rtl",
        title: "siymon | ØµÙØ­Ø© Ù‡Ø¨ÙˆØ· Ù„Ø·Ù„Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù…",
        subtitle: "Ø§Ø·Ù„Ø¨ Ø£ÙƒÙ„Ùƒ Ø§Ù„Ù…ÙØ¶Ù„ Ø¨Ø³Ø±Ø¹Ø©",
        cartTitle: "Ø§Ù„Ø³Ù„Ø©",
        emptyCart: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©. Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ‘‡",

        openNow: "Ù…ÙØªÙˆØ­ Ø§Ù„Ø¢Ù†",
        closedNow: "Ù…ØºÙ„Ù‚ Ø§Ù„Ø¢Ù†",
        hoursText: "Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„: 12:00 Ø¥Ù„Ù‰ 00:00 â€” Ù…Ù† Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†",

        subTotalLabel: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ",
        deliveryFeeLabel: "Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",
        totalLabel: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",

        deliveryFeeInputLabel: "Ù‚ÙŠÙ…Ø© Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",
        deliveryFeePlaceholder: "Ù…Ø«Ø§Ù„: 10",
        deliveryFeeHint: "ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù…Ø³Ø§ÙØ©.",

        nameLabel: "Ø§Ù„Ø§Ø³Ù…",
        phoneLabel: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ",
        addrLabel: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
        notesLabel: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",

        sendText: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
        clearText: "ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©",
        addBtn: "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©",
        categoryAll: "Ø§Ù„ÙƒÙ„",

        getAddrText: "Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹",
        locHint: "Ù‚Ø¯ ÙŠØ·Ù„Ø¨ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¥Ø°Ù† Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.",

        printText: "Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©",
        btPrintText: "Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ«",
        bt: {
          unsupported: "Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¨Ù„ÙˆØªÙˆØ« ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.",
          needHttps: "Ø®Ø§Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠÙƒÙˆÙ† HTTPS Ø¨Ø§Ø´ ÙŠØ®Ø¯Ù… Web Bluetooth.",
          connecting: "Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©...",
          connected: "ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© âœ…",
          failed: "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©.",
          printed: "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø·Ø§Ø¨Ø¹Ø© âœ…"
        },

        geo: {
          unsupported: "Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹",
          denied: "ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙƒØŒ Ø§Ù„Ù…Ø±Ø¬Ùˆ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹",
          locating: "Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...",
          filled: "ØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ âœ…",
          failed: "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ ØªÙ… ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¨Ø¯Ù„Ù‹Ø§ Ø¹Ù†Ù‡."
        },

        validations: {
          needItems: "Ø£Ø¶Ù Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø³Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹.",
          needName: "Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù…Ù† ÙØ¶Ù„Ùƒ.",
          needPhone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¥Ø¬Ø¨Ø§Ø±ÙŠ.",
          needAddress: "Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ù† ÙØ¶Ù„Ùƒ.",
          closed: "Ø§Ù„Ù…ØªØ¬Ø± Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠØ§Ù‹. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†."
        },

        footer: "Â© siymon",
        msg: {
          header: "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† siymon",
          customer: "Ø§Ù„Ø²Ø¨ÙˆÙ†",
          phone: "Ø§Ù„Ù‡Ø§ØªÙ",
          address: "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",
          notes: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
          items: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
          subtotal: "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ",
          deliveryFee: "Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",
          total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
          thanks: "Ø´ÙƒØ±Ø§Ù‹ Ù„ÙƒÙ…"
        }
      },
      en: {
        dir: "ltr",
        title: "siymon | Food Ordering Landing Page",
        subtitle: "Order your favorite food fast",
        cartTitle: "Cart",
        emptyCart: "Cart is empty. Add items from the list ğŸ‘‡",

        openNow: "Open now",
        closedNow: "Closed now",
        hoursText: "Working hours: 12:00 â†’ 00:00 â€” Sun to Mon",

        subTotalLabel: "Subtotal",
        deliveryFeeLabel: "Delivery fee",
        totalLabel: "Total",

        deliveryFeeInputLabel: "Delivery fee amount",
        deliveryFeePlaceholder: "e.g. 10",
        deliveryFeeHint: "Adjust based on distance/city.",

        nameLabel: "Name",
        phoneLabel: "Phone",
        addrLabel: "Address",
        notesLabel: "Notes (optional)",

        sendText: "Send order via WhatsApp",
        clearText: "Clear cart",
        addBtn: "Add to cart",
        categoryAll: "All",

        getAddrText: "Auto-fill address",
        locHint: "Your browser may ask for location permission.",

        printText: "Print invoice",
        btPrintText: "Print via Bluetooth",
        bt: {
          unsupported: "Bluetooth printing is not supported in this browser.",
          needHttps: "Web Bluetooth requires HTTPS.",
          connecting: "Connecting to printer...",
          connected: "Printer connected âœ…",
          failed: "Couldn't connect to printer.",
          printed: "Invoice sent to printer âœ…"
        },

        geo: {
          unsupported: "Geolocation is not supported by your browser.",
          denied: "Couldn't get your location. Please allow location access.",
          locating: "Getting your location...",
          filled: "Address filled successfully âœ…",
          failed: "Couldn't fetch address; coordinates were used instead."
        },

        validations: {
          needItems: "Please add items to the cart first.",
          needName: "Please enter your name.",
          needPhone: "Phone number is required.",
          needAddress: "Please enter your address.",
          closed: "We are currently closed. You can't place an order now."
        },

        footer: "Â© siymon",
        msg: {
          header: "New order from siymon",
          customer: "Customer",
          phone: "Phone",
          address: "Address",
          notes: "Notes",
          items: "Items",
          subtotal: "Subtotal",
          deliveryFee: "Delivery fee",
          total: "Total",
          thanks: "Thank you"
        }
      }
    };

    const products = [
      { id:"m1", cat:"moroccan", catLabel:{ar:"Ù…ØºØ±Ø¨ÙŠ", en:"Moroccan"}, price:35,
        img:"https://images.unsplash.com/photo-1541518763669-27fef04b14ea?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø·Ø§Ø¬ÙŠÙ† Ø¯Ø¬Ø§Ø¬", en:"Chicken Tagine"},
        desc:{ar:"Ø·Ø§Ø¬ÙŠÙ† Ø¯Ø¬Ø§Ø¬ Ø¨Ø§Ù„Ù„ÙŠÙ…ÙˆÙ† ÙˆØ§Ù„Ø²ÙŠØªÙˆÙ†", en:"Chicken tagine with lemon & olives"} },
      { id:"m2", cat:"moroccan", price:25,
        img:"https://images.unsplash.com/photo-1601050690597-df0568f70950?auto=format&fit=crop&w=900&q=70",
        name:{ar:"ÙƒØ³ÙƒØ³", en:"Couscous"},
        desc:{ar:"ÙƒØ³ÙƒØ³ Ø¨Ø§Ù„Ø®Ø¶Ø± ÙˆØ§Ù„Ù…Ø±Ù‚", en:"Couscous with vegetables"} },

      { id:"i1", cat:"italian", catLabel:{ar:"Ø¥ÙŠØ·Ø§Ù„ÙŠ", en:"Italian"}, price:45,
        img:"https://images.unsplash.com/photo-1521389508051-d7ffb5dc8ff7?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¨ÙŠØªØ²Ø§ Ù…Ø§Ø±ØºØ±ÙŠØªØ§", en:"Margherita Pizza"},
        desc:{ar:"Ø·Ù…Ø§Ø·Ù… + Ø¬Ø¨Ù† + Ø±ÙŠØ­Ø§Ù†", en:"Tomato + cheese + basil"} },
      { id:"i2", cat:"italian", price:40,
        img:"https://images.unsplash.com/photo-1604908554085-2c0a82b1f345?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¨Ø§Ø³ØªØ§ Ø£Ù„ÙØ±ÙŠØ¯Ùˆ", en:"Alfredo Pasta"},
        desc:{ar:"ØµÙ„ØµØ© ÙƒØ±ÙŠÙ…ÙŠØ© ÙˆØ¬Ø¨Ù†", en:"Creamy sauce & cheese"} },

      { id:"a1", cat:"american", catLabel:{ar:"Ø£Ù…Ø±ÙŠÙƒÙŠ", en:"American"}, price:50,
        img:"https://images.unsplash.com/photo-1550547660-d9450f859349?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¨Ø±ØºØ± Ù„Ø­Ù…", en:"Beef Burger"},
        desc:{ar:"Ø¨Ø±ØºØ± Ù…Ø¹ Ø¨Ø·Ø§Ø·Ø³", en:"Burger with fries"} },
      { id:"a2", cat:"american", price:30,
        img:"https://images.unsplash.com/photo-1604908176997-125f25cc5002?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¯Ø¬Ø§Ø¬ Ù…Ù‚Ø±Ù…Ø´", en:"Crispy Chicken"},
        desc:{ar:"Ù‚Ø·Ø¹ Ø¯Ø¬Ø§Ø¬ Ù…Ù‚Ø±Ù…Ø´Ø©", en:"Crispy chicken bites"} },

      { id:"h1", cat:"indian", catLabel:{ar:"Ù‡Ù†Ø¯ÙŠ", en:"Indian"}, price:55,
        img:"https://images.unsplash.com/photo-1604908176997-125f25cc5002?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ø¯Ø¬Ø§Ø¬ ØªÙŠÙƒØ§ Ù…Ø§Ø³Ø§Ù„Ø§", en:"Chicken Tikka Masala"},
        desc:{ar:"ØµÙ„ØµØ© Ù…ØªØ¨Ù„Ø© ÙˆÙƒØ±ÙŠÙ…ÙŠØ©", en:"Spiced creamy sauce"} },
      { id:"h2", cat:"indian", price:20,
        img:"https://images.unsplash.com/photo-1625944522862-37c4f97e3b16?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ù†Ø§Ù†", en:"Naan Bread"},
        desc:{ar:"Ø®Ø¨Ø² Ù‡Ù†Ø¯ÙŠ Ø·Ø±ÙŠ", en:"Soft Indian bread"} },

      { id:"s1", cat:"soda", catLabel:{ar:"Ù…Ø´Ø±ÙˆØ¨Ø§Øª ØºØ§Ø²ÙŠØ©", en:"Soda"}, price:10,
        img:"https://images.unsplash.com/photo-1543253687-c931c8e01820?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ù…Ø´Ø±ÙˆØ¨ ØºØ§Ø²ÙŠ", en:"Soda"},
        desc:{ar:"Ø¹Ù„Ø¨Ø© 330ml", en:"Can 330ml"} },

      { id:"w1", cat:"water", catLabel:{ar:"Ù…ÙŠØ§Ù‡", en:"Water"}, price:6,
        img:"https://images.unsplash.com/photo-1528825871115-3581a5387919?auto=format&fit=crop&w=900&q=70",
        name:{ar:"Ù…Ø§Ø¡ Ù…Ø¹Ø¯Ù†ÙŠ", en:"Mineral Water"},
        desc:{ar:"Ù‚Ø§Ø±ÙˆØ±Ø© 500ml", en:"Bottle 500ml"} }
    ];

    let lang = "ar";
    let activeCat = "all";
    const cart = new Map();

    const el = (id) => document.getElementById(id);

    const productsGrid = el("productsGrid");
    const cartItems = el("cartItems");
    const categoryChips = el("categoryChips");

    const subTotalValue = el("subTotalValue");
    const deliveryFeeValue = el("deliveryFeeValue");
    const totalValue = el("totalValue");
    const cartCount = el("cartCount");

    const openBadge = el("openBadge");
    const openText  = el("openText");
    const hoursText = el("hoursText");

    const langToggle = el("langToggle");
    const clearCartBtn = el("clearCart");
    const goCartBtn = el("goCart");
    const sendBtn = el("sendWhatsApp");

    const getAddrBtn = el("getAddrBtn");
    const locHint = el("locHint");

    const printBtn = el("printInvoice");
    const btPrintBtn = el("btPrintInvoice");

    const closedHint = el("closedHint");

    const deliveryFeeInput = el("deliveryFeeInput");

    const custName = el("custName");
    const custPhone = el("custPhone");
    const custAddr = el("custAddr");
    const custNotes = el("custNotes");

    const LS_KEY = "siymon_cart_v4";

    function saveCart(){
      const obj = {
        lang,
        items: Array.from(cart.entries()),
        activeCat,
        deliveryFee: deliveryFeeInput.value || "",
        customer: {
          name: custName.value || "",
          phone: custPhone.value || "",
          addr: custAddr.value || "",
          notes: custNotes.value || ""
        }
      };
      localStorage.setItem(LS_KEY, JSON.stringify(obj));
    }

    function loadCart(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const obj = JSON.parse(raw);

        if(obj?.lang) lang = obj.lang;
        if(obj?.activeCat) activeCat = obj.activeCat;

        if(typeof obj?.deliveryFee === "string") deliveryFeeInput.value = obj.deliveryFee;

        if(Array.isArray(obj?.items)){
          cart.clear();
          obj.items.forEach(([id, qty])=>{
            if(typeof id==="string" && Number.isFinite(qty) && qty>0) cart.set(id, qty);
          });
        }

        if(obj?.customer){
          custName.value = obj.customer.name || "";
          custPhone.value = obj.customer.phone || "";
          custAddr.value = obj.customer.addr || "";
          custNotes.value = obj.customer.notes || "";
        }
      }catch(e){}
    }

    function money(v){
      const num = Number(v || 0);
      return num.toFixed(2) + " " + (lang==="ar" ? CURRENCY_AR : CURRENCY_EN);
    }

    function getProduct(id){ return products.find(p => p.id === id); }

    function cartSubTotal(){
      let total = 0;
      for(const [id, qty] of cart.entries()){
        const p = getProduct(id);
        if(p) total += p.price * qty;
      }
      return total;
    }

    function getDeliveryFee(){
      const n = Number(deliveryFeeInput.value || DEFAULT_DELIVERY_FEE || 0);
      return Number.isFinite(n) && n >= 0 ? n : 0;
    }

    function cartGrandTotal(){
      return cartSubTotal() + getDeliveryFee();
    }

    function cartItemsCount(){
      let c = 0;
      for(const qty of cart.values()) c += qty;
      return c;
    }

    function isBusinessOpen(now = new Date()){
      const day = now.getDay();
      const minutesNow = now.getHours()*60 + now.getMinutes();

      const openMin  = BUSINESS.open.h*60  + BUSINESS.open.m;
      const closeMin = BUSINESS.close.h*60 + BUSINESS.close.m;

      const overnight = closeMin <= openMin;
      const isDayAllowed = (d) => BUSINESS.days.includes(d);

      if(!overnight){
        return isDayAllowed(day) && minutesNow >= openMin && minutesNow < closeMin;
      }

      if(minutesNow < closeMin){
        const prevDay = (day + 6) % 7;
        return isDayAllowed(prevDay);
      }
      return isDayAllowed(day) && minutesNow >= openMin;
    }

    function updateOpenStatus(){
      const open = isBusinessOpen(new Date());
      openBadge.classList.toggle("open", open);
      openBadge.classList.toggle("closed", !open);

      openText.textContent = open ? i18n[lang].openNow : i18n[lang].closedNow;
      hoursText.textContent = i18n[lang].hoursText;

      sendBtn.disabled = !open;
      closedHint.style.display = open ? "none" : "block";
    }

    function applyI18n(){
      document.documentElement.lang = lang;
      document.documentElement.dir = i18n[lang].dir;
      document.title = i18n[lang].title;

      el("subtitle").textContent = i18n[lang].subtitle;

      el("cartTitle").textContent = i18n[lang].cartTitle;
      el("subTotalLabel").textContent = i18n[lang].subTotalLabel;
      el("deliveryFeeLabel").textContent = i18n[lang].deliveryFeeLabel;
      el("totalLabel").textContent = i18n[lang].totalLabel;

      el("deliveryFeeInputLabel").textContent = i18n[lang].deliveryFeeInputLabel;
      deliveryFeeInput.placeholder = i18n[lang].deliveryFeePlaceholder;
      el("deliveryFeeHint").textContent = i18n[lang].deliveryFeeHint;

      el("nameLabel").textContent = i18n[lang].nameLabel;
      el("phoneLabel").textContent = i18n[lang].phoneLabel;
      el("addrLabel").textContent = i18n[lang].addrLabel;
      el("notesLabel").textContent = i18n[lang].notesLabel;

      el("sendText").textContent = i18n[lang].sendText;
      el("getAddrText").textContent = i18n[lang].getAddrText;
      locHint.textContent = i18n[lang].locHint;

      el("printText").textContent = i18n[lang].printText;
      el("btPrintText").textContent = i18n[lang].btPrintText;

      el("clearText").textContent = i18n[lang].clearText;
      el("footerText").textContent = i18n[lang].footer;

      langToggle.textContent = (lang === "ar") ? "EN" : "AR";

      custName.placeholder = (lang==="ar") ? "Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" : "e.g. John";
      custPhone.placeholder = (lang==="ar") ? "06xxxxxxxx" : "Phone number";
      custAddr.placeholder = (lang==="ar") ? "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø§Ù„Ø­ÙŠ..." : "City, street...";
      custNotes.placeholder = (lang==="ar") ? "Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ØŒ Ø­Ø§Ø±ØŒ ..." : "No onions, spicy, ...";

      updateOpenStatus();
    }

    function buildCategoriesFromProducts(){
      const map = new Map();
      for(const p of products){
        if(!p?.cat) continue;
        if(map.has(p.cat)) continue;
        const label = p.catLabel || { ar: p.cat, en: p.cat };
        map.set(p.cat, label);
      }
      return Array.from(map.entries()).map(([key, label]) => ({
        key,
        label: (label && (label[lang] || label.en || label.ar)) || key
      }));
    }

    function normalizeActiveCat(){
      if(activeCat === "all") return;
      const cats = buildCategoriesFromProducts().map(c => c.key);
      if(!cats.includes(activeCat)) activeCat = "all";
    }

    function renderCategories(){
      normalizeActiveCat();
      const cats = buildCategoriesFromProducts();
      const list = [{ key:"all", label: i18n[lang].categoryAll }, ...cats];

      categoryChips.innerHTML = "";
      list.forEach(c=>{
        const btn = document.createElement("div");
        btn.className = "chip" + (activeCat===c.key ? " active" : "");
        btn.textContent = c.label;
        btn.addEventListener("click", ()=>{
          activeCat = c.key;
          renderAll();
          saveCart();
        });
        categoryChips.appendChild(btn);
      });
    }

    function renderProducts(){
      const filtered = (activeCat==="all") ? products : products.filter(p => p.cat === activeCat);
      productsGrid.innerHTML = "";

      filtered.forEach(p=>{
        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <div class="img">
            <img src="${p.img}" alt="${p.name[lang]}" loading="lazy"
                 onerror="this.onerror=null;this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22600%22 height=%22400%22><rect width=%22100%25%22 height=%22100%25%22 fill=%22%23eee%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22 font-family=%22Arial%22 font-size=%2220%22>Image</text></svg>';">
          </div>
          <h3>${p.name[lang]}</h3>
          <p>${p.desc[lang]}</p>
          <div class="row">
            <span class="price">${money(p.price)}</span>
          </div>
          <button class="btn primary add addBtn" data-id="${p.id}" type="button">â• ${i18n[lang].addBtn}</button>
        `;

        productsGrid.appendChild(card);
      });

      document.querySelectorAll(".addBtn").forEach(b=>{
        b.addEventListener("click", ()=>{
          const id = b.getAttribute("data-id");
          addToCart(id, 1);
        });
      });
    }

    function renderCart(){
      cartItems.innerHTML = "";

      if(cart.size === 0){
        cartItems.innerHTML = `<div class="empty">${i18n[lang].emptyCart}</div>`;
      }else{
        for(const [id, qty] of cart.entries()){
          const p = getProduct(id);
          if(!p) continue;

          const subtotal = p.price * qty;

          const item = document.createElement("div");
          item.className = "cart-item";
          item.innerHTML = `
            <div>
              <b>${p.name[lang]}</b>
              <small>${money(p.price)} â€¢ <span class="muted">${money(subtotal)}</span></small>
            </div>
            <div class="qty">
              <button type="button" data-act="minus" data-id="${id}">âˆ’</button>
              <span>${qty}</span>
              <button type="button" data-act="plus" data-id="${id}">+</button>
            </div>
          `;
          cartItems.appendChild(item);
        }

        cartItems.querySelectorAll("button").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const act = btn.getAttribute("data-act");
            const id = btn.getAttribute("data-id");
            if(act==="plus") addToCart(id, 1);
            if(act==="minus") addToCart(id, -1);
          });
        });
      }

      const sub = cartSubTotal();
      const fee = getDeliveryFee();
      const grand = cartGrandTotal();

      subTotalValue.textContent = money(sub);
      deliveryFeeValue.textContent = money(fee);
      totalValue.textContent = money(grand);

      cartCount.textContent = String(cartItemsCount());

      printBtn.disabled = (cart.size === 0);
      btPrintBtn.disabled = (cart.size === 0);

      updateOpenStatus();
    }

    function renderAll(){
      applyI18n();
      renderCategories();
      renderProducts();
      renderCart();
    }

    function addToCart(id, delta){
      const p = getProduct(id);
      if(!p) return;

      const cur = cart.get(id) || 0;
      const next = cur + delta;

      if(next <= 0) cart.delete(id);
      else cart.set(id, next);

      renderCart();
      saveCart();
    }

    function clearCart(){
      cart.clear();
      renderCart();
      saveCart();
    }

    async function getLocation(){
      if(!navigator.geolocation){
        alert(i18n[lang].geo.unsupported);
        return;
      }

      getAddrBtn.disabled = true;
      const oldText = el("getAddrText").textContent;
      el("getAddrText").textContent = i18n[lang].geo.locating;

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        try{
          const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`;
          const res = await fetch(url, {
            headers: {
              "Accept": "application/json",
              "Accept-Language": (lang === "ar") ? "ar" : "en"
            }
          });
          const data = await res.json();
          const display = (data && data.display_name) ? data.display_name : `Lat: ${lat}, Lng: ${lng}`;

          custAddr.value = display;
          custAddr.dispatchEvent(new Event("input", { bubbles:true }));
          locHint.textContent = i18n[lang].geo.filled;
        }catch(e){
          custAddr.value = `Lat: ${lat}, Lng: ${lng}`;
          custAddr.dispatchEvent(new Event("input", { bubbles:true }));
          locHint.textContent = i18n[lang].geo.failed;
        }finally{
          getAddrBtn.disabled = false;
          el("getAddrText").textContent = oldText;
        }
      }, () => {
        alert(i18n[lang].geo.denied);
        getAddrBtn.disabled = false;
        el("getAddrText").textContent = oldText;
      }, { enableHighAccuracy:true, timeout:10000, maximumAge:0 });
    }

    function validateOrderBasics(){
      if(!isBusinessOpen(new Date())) return i18n[lang].validations.closed;

      const name = custName.value.trim();
      const phone = custPhone.value.trim();
      const addr = custAddr.value.trim();

      if(cart.size === 0) return i18n[lang].validations.needItems;
      if(!name) return i18n[lang].validations.needName;
      if(!phone) return i18n[lang].validations.needPhone;
      if(!addr) return i18n[lang].validations.needAddress;

      return null;
    }

    function buildWhatsAppMessage(){
      const err = validateOrderBasics();
      if(err) return { error: err };

      const tr = i18n[lang].msg;

      const name = custName.value.trim();
      const phone = custPhone.value.trim();
      const addr = custAddr.value.trim();
      const notes = custNotes.value.trim();

      const lines = [];
      lines.push(`ğŸ§¾ ${tr.header}`);
      lines.push(`----------------------`);
      lines.push(`ğŸ‘¤ ${tr.customer}: ${name}`);
      lines.push(`ğŸ“ ${tr.phone}: ${phone}`);
      lines.push(`ğŸ“ ${tr.address}: ${addr}`);
      if(notes) lines.push(`ğŸ“ ${tr.notes}: ${notes}`);
      lines.push(`----------------------`);
      lines.push(`ğŸ›’ ${tr.items}:`);

      for(const [id, qty] of cart.entries()){
        const p = getProduct(id);
        if(!p) continue;
        const subtotal = p.price * qty;
        lines.push(`- ${p.name[lang]} Ã— ${qty} = ${money(subtotal)}`);
      }

      const sub = cartSubTotal();
      const fee = getDeliveryFee();
      const grand = cartGrandTotal();

      lines.push(`----------------------`);
      lines.push(`ğŸ§® ${tr.subtotal}: ${money(sub)}`);
      lines.push(`ğŸšš ${tr.deliveryFee}: ${money(fee)}`);
      lines.push(`ğŸ’° ${tr.total}: ${money(grand)}`);
      lines.push(`ğŸ™ ${tr.thanks}`);

      return { text: lines.join("\n") };
    }

    function sendToWhatsApp(){
      const msg = buildWhatsAppMessage();
      if(msg.error){
        alert(msg.error);
        return;
      }
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg.text)}`;
      window.open(url, "_blank");
    }

    function buildInvoiceHTML(){
      const err = validateOrderBasics();
      if(err) return { error: err };

      const tr = i18n[lang].msg;
      const now = new Date();
      const dateStr = now.toLocaleString(lang === "ar" ? "ar-MA" : "en-US");

      const name = custName.value.trim();
      const phone = custPhone.value.trim();
      const addr = custAddr.value.trim();
      const notes = custNotes.value.trim();

      const sub = cartSubTotal();
      const fee = getDeliveryFee();
      const grand = cartGrandTotal();

      const rows = Array.from(cart.entries()).map(([id, qty])=>{
        const p = getProduct(id);
        if(!p) return "";
        const lineTotal = p.price * qty;
        return `
          <tr>
            <td>${p.name[lang]}</td>
            <td style="text-align:center">${qty}</td>
            <td style="text-align:center">${money(p.price)}</td>
            <td style="text-align:center">${money(lineTotal)}</td>
          </tr>
        `;
      }).join("");

      const html = `
<!doctype html>
<html lang="${lang}" dir="${i18n[lang].dir}">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Invoice</title>
<style>
  body{font-family:Arial, sans-serif; padding:20px; color:#111}
  .head{display:flex; align-items:center; gap:12px}
  .logo{width:54px;height:54px;border-radius:12px;background:#000;padding:6px;object-fit:contain}
  h1{margin:0;font-size:18px}
  .muted{color:#666;font-size:12px;margin-top:4px}
  table{width:100%;border-collapse:collapse;margin-top:14px}
  th,td{border:1px solid #ddd;padding:8px;font-size:13px}
  th{background:#f6f6f6}
  .totals{margin-top:12px; max-width:420px; margin-inline-start:auto}
  .totals div{display:flex; justify-content:space-between; padding:6px 0; font-weight:700}
  .totals .grand{border-top:2px solid #111; padding-top:10px}
  .box{margin-top:12px; padding:10px; border:1px solid #ddd; border-radius:10px}
  .btn{margin-top:14px; padding:10px 12px; border:1px solid #111; background:#fff; cursor:pointer; border-radius:10px; font-weight:700}
  @media print{ .btn{display:none} body{padding:0} }
</style>
</head>
<body>
  <div class="head">
    <img class="logo" src="https://uploads.onecompiler.io/43xh82fwf/44atfud5t/Photoroom-20260117_132534545.png" alt="logo"/>
    <div>
      <h1>siymon</h1>
      <div class="muted">${dateStr}</div>
    </div>
  </div>

  <div class="box">
    <div><b>${tr.customer}:</b> ${name}</div>
    <div><b>${tr.phone}:</b> ${phone}</div>
    <div><b>${tr.address}:</b> ${addr}</div>
    <div><b>${tr.notes}:</b> ${notes || "-"}</div>
  </div>

  <table>
    <thead>
      <tr>
        <th>${tr.items}</th>
        <th style="width:70px;text-align:center">Qty</th>
        <th style="width:120px;text-align:center">Price</th>
        <th style="width:140px;text-align:center">Total</th>
      </tr>
    </thead>
    <tbody>${rows}</tbody>
  </table>

  <div class="totals">
    <div><span>${tr.subtotal}</span><span>${money(sub)}</span></div>
    <div><span>${tr.deliveryFee}</span><span>${money(fee)}</span></div>
    <div class="grand"><span>${tr.total}</span><span>${money(grand)}</span></div>
  </div>

  <button class="btn" onclick="window.print()">${lang==="ar" ? "Ø·Ø¨Ø§Ø¹Ø©" : "Print"}</button>
</body>
</html>
      `.trim();

      return { html };
    }

    function printInvoice(){
      const res = buildInvoiceHTML();
      if(res.error){
        alert(res.error);
        return;
      }
      const w = window.open("", "_blank");
      if(!w){
        alert(lang==="ar" ? "Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù†Ø¹ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©." : "Popup blocked.");
        return;
      }
      w.document.open();
      w.document.write(res.html);
      w.document.close();
    }

    let printerChar = null;

    function buildInvoiceTextPlain(){
      const err = validateOrderBasics();
      if(err) return { error: err };

      const tr = i18n[lang].msg;
      const now = new Date();
      const dateStr = now.toLocaleString(lang === "ar" ? "ar-MA" : "en-US");

      const name = custName.value.trim();
      const phone = custPhone.value.trim();
      const addr = custAddr.value.trim();
      const notes = custNotes.value.trim();

      const sub = cartSubTotal();
      const fee = getDeliveryFee();
      const grand = cartGrandTotal();

      const lines = [];
      lines.push("siymon");
      lines.push(dateStr);
      lines.push("------------------------------");
      lines.push(`${tr.customer}: ${name}`);
      lines.push(`${tr.phone}: ${phone}`);
      lines.push(`${tr.address}: ${addr}`);
      if(notes) lines.push(`${tr.notes}: ${notes}`);
      lines.push("------------------------------");
      lines.push(tr.items + ":");

      for(const [id, qty] of cart.entries()){
        const p = getProduct(id);
        if(!p) continue;
        const lineTotal = p.price * qty;
        lines.push(`- ${p.name[lang]} x ${qty} = ${money(lineTotal)}`);
      }

      lines.push("------------------------------");
      lines.push(`${tr.subtotal}: ${money(sub)}`);
      lines.push(`${tr.deliveryFee}: ${money(fee)}`);
      lines.push(`${tr.total}: ${money(grand)}`);
      lines.push("------------------------------");
      lines.push(tr.thanks);
      lines.push("\n\n\n");

      return { text: lines.join("\n") };
    }

    function escposBytes(text){
      const enc = new TextEncoder();
      const init = new Uint8Array([0x1B,0x40]);
      const alignCenter = new Uint8Array([0x1B,0x61,0x01]);
      const alignLeft = new Uint8Array([0x1B,0x61,0x00]);
      const boldOn = new Uint8Array([0x1B,0x45,0x01]);
      const boldOff = new Uint8Array([0x1B,0x45,0x00]);
      const cut = new Uint8Array([0x1D,0x56,0x01,0x00]);

      const parts = [];
      parts.push(init);
      parts.push(alignCenter);
      parts.push(boldOn);
      parts.push(enc.encode("siymon\n"));
      parts.push(boldOff);
      parts.push(alignLeft);
      parts.push(enc.encode(text));
      parts.push(cut);

      let totalLen = 0;
      for(const p of parts) totalLen += p.length;

      const out = new Uint8Array(totalLen);
      let offset = 0;
      for(const p of parts){
        out.set(p, offset);
        offset += p.length;
      }
      return out;
    }

    async function writeChunks(characteristic, data){
      const chunkSize = 180;
      for(let i=0;i<data.length;i+=chunkSize){
        const chunk = data.slice(i, i+chunkSize);
        if(characteristic.writeValueWithoutResponse){
          await characteristic.writeValueWithoutResponse(chunk);
        }else{
          await characteristic.writeValue(chunk);
        }
        await new Promise(r=>setTimeout(r, 30));
      }
    }

    async function connectBluetoothPrinter(){
      if(!("bluetooth" in navigator)){
        throw new Error("UNSUPPORTED");
      }
      if(location.protocol !== "https:" && location.hostname !== "localhost"){
        throw new Error("NEED_HTTPS");
      }

      const knownServices = [
        "0000ffe0-0000-1000-8000-00805f9b34fb",
        "0000ff00-0000-1000-8000-00805f9b34fb",
        "49535343-fe7d-4ae5-8fa9-9fafd205e455"
      ];

      const device = await navigator.bluetooth.requestDevice({
        acceptAllDevices: true,
        optionalServices: knownServices
      });

      const server = await device.gatt.connect();

      const tryService = async (svcUuid) => {
        try{
          const svc = await server.getPrimaryService(svcUuid);
          const chars = await svc.getCharacteristics();
          for(const ch of chars){
            if(ch.properties.write || ch.properties.writeWithoutResponse) return ch;
          }
        }catch(e){}
        return null;
      };

      for(const svc of knownServices){
        const ch = await tryService(svc);
        if(ch) return ch;
      }

      const services = await server.getPrimaryServices();
      for(const svc of services){
        const chars = await svc.getCharacteristics();
        for(const ch of chars){
          if(ch.properties.write || ch.properties.writeWithoutResponse) return ch;
        }
      }

      throw new Error("NO_WRITABLE_CHAR");
    }

    async function btPrintInvoice(){
      const inv = buildInvoiceTextPlain();
      if(inv.error){
        alert(inv.error);
        return;
      }

      try{
        btPrintBtn.disabled = true;
        const old = el("btPrintText").textContent;
        el("btPrintText").textContent = i18n[lang].bt.connecting;

        if(!printerChar){
          printerChar = await connectBluetoothPrinter();
          // Ù„Ø§ Ù†Ø¹Ø±Ø¶ Ø£ÙŠ Ø¬Ù…Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù‡Ù†Ø§
        }

        const bytes = escposBytes(inv.text);
        await writeChunks(printerChar, bytes);

        el("btPrintText").textContent = old;
        btPrintBtn.disabled = false;
      }catch(err){
        btPrintBtn.disabled = false;
        el("btPrintText").textContent = i18n[lang].btPrintText;

        if(String(err?.message || err) === "UNSUPPORTED"){
          alert(i18n[lang].bt.unsupported);
        }else if(String(err?.message || err) === "NEED_HTTPS"){
          alert(i18n[lang].bt.needHttps);
        }else{
          alert(i18n[lang].bt.failed);
        }
      }
    }

    function sendToWhatsApp(){
      const msg = buildWhatsAppMessage();
      if(msg.error){
        alert(msg.error);
        return;
      }
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg.text)}`;
      window.open(url, "_blank");
    }

    langToggle.addEventListener("click", ()=>{
      lang = (lang === "ar") ? "en" : "ar";
      renderAll();
      saveCart();
    });

    clearCartBtn.addEventListener("click", clearCart);

    goCartBtn.addEventListener("click", ()=>{
      document.getElementById("cartPanel").scrollIntoView({behavior:"smooth", block:"start"});
    });

    sendBtn.addEventListener("click", sendToWhatsApp);
    getAddrBtn.addEventListener("click", getLocation);
    printBtn.addEventListener("click", printInvoice);
    btPrintBtn.addEventListener("click", btPrintInvoice);

    deliveryFeeInput.addEventListener("input", ()=>{
      renderCart();
      saveCart();
    });

    [custName, custPhone, custAddr, custNotes].forEach(input=>{
      input.addEventListener("input", ()=> saveCart());
    });

    loadCart();
    if(!deliveryFeeInput.value) deliveryFeeInput.value = String(DEFAULT_DELIVERY_FEE);

    renderAll();
    setInterval(()=> updateOpenStatus(), 60_000);
  </script>
</body>
</html>
